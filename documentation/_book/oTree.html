<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.3.353">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">


<title>oFeeds: Documentation - 1&nbsp; Deploy oFeeds</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="site_libs/quarto-nav/quarto-nav.js"></script>
<script src="site_libs/quarto-nav/headroom.min.js"></script>
<script src="site_libs/clipboard/clipboard.min.js"></script>
<script src="site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="site_libs/quarto-search/fuse.min.js"></script>
<script src="site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="./">
<link href="./oCom.html" rel="next">
<link href="./index.html" rel="prev">
<script src="site_libs/quarto-html/quarto.js"></script>
<script src="site_libs/quarto-html/popper.min.js"></script>
<script src="site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="site_libs/quarto-html/anchor.min.js"></script>
<link href="site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="site_libs/bootstrap/bootstrap.min.js"></script>
<link href="site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 20,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit"
  }
}</script>


</head>

<body class="nav-sidebar floating">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
      <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="./oTree.html"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Deploy `oFeeds`</span></a></li></ol></nav>
      <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
      </a>
      <button type="button" class="btn quarto-search-button" aria-label="Search" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal sidebar-navigation floating overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="./">oFeeds: Documentation</a> 
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./index.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Preface</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./oTree.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Deploy <code>oFeeds</code></span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./oCom.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">oCom</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./oNovitas.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">3</span>&nbsp; <span class="chapter-title">oNovitas</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./oTweet.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">4</span>&nbsp; <span class="chapter-title">oTweet</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./prolific.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text"><span class="chapter-number">5</span>&nbsp; <span class="chapter-title">Prolific</span></span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="./references.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">References</span></a>
  </div>
</li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar,#quarto-sidebar-glass"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#run-otree" id="toc-run-otree" class="nav-link active" data-scroll-target="#run-otree"><span class="header-section-number">1.1</span> Run oTree</a>
  <ul class="collapse">
  <li><a href="#prerequisites" id="toc-prerequisites" class="nav-link" data-scroll-target="#prerequisites"><span class="header-section-number">1.1.1</span> Prerequisites</a></li>
  <li><a href="#install-otree" id="toc-install-otree" class="nav-link" data-scroll-target="#install-otree"><span class="header-section-number">1.1.2</span> Install oTree</a></li>
  <li><a href="#download-unzip-edit-ofeeds" id="toc-download-unzip-edit-ofeeds" class="nav-link" data-scroll-target="#download-unzip-edit-ofeeds"><span class="header-section-number">1.1.3</span> Download, Unzip &amp; Edit <code>oFeeds</code></a></li>
  </ul></li>
  <li><a href="#sec-local" id="toc-sec-local" class="nav-link" data-scroll-target="#sec-local"><span class="header-section-number">1.2</span> Deploy <code>oFeeds</code> Locally</a></li>
  <li><a href="#sec-server" id="toc-sec-server" class="nav-link" data-scroll-target="#sec-server"><span class="header-section-number">1.3</span> Deploy <code>oFeeds</code> on a Server</a></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title"><span class="chapter-number">1</span>&nbsp; <span class="chapter-title">Deploy <code>oFeeds</code></span></h1>
</div>



<div class="quarto-title-meta">

    
  
    
  </div>
  

</header>

<!-- remember: git subtree push --prefix documentation/_book  origin gh-pages -->
<p>If you want to edit, test and run oFeed’s code locally, you’ll need to install oTree. If you just want want to deploy it on a server, you can skip the first sections and start with <a href="#sec-server"><span>Section&nbsp;1.3</span></a> of this chapter.</p>
<p>This guide instructs you how to deploy one of the <code>oFeeds</code> apps either locally or on a server and how to connect that server to a prolific study. It does not introduce you to oTree <em>per se</em>. If you are interested in creating your own oTree apps, I recommend <a href="https://otree.readthedocs.io/en/latest/">oTree’s official documentation</a>.</p>
<section id="run-otree" class="level2" data-number="1.1">
<h2 data-number="1.1" class="anchored" data-anchor-id="run-otree"><span class="header-section-number">1.1</span> Run oTree</h2>
<section id="prerequisites" class="level3" data-number="1.1.1">
<h3 data-number="1.1.1" class="anchored" data-anchor-id="prerequisites"><span class="header-section-number">1.1.1</span> Prerequisites</h3>
<p>To run oTree, you need Python3 (and its package manager PIP). In addition, you’ll need some basic experience with command line tools (your terminal) as well as an IDE such as PyCharm.</p>
<ul>
<li><a href="https://www.w3schools.com/python/python_pip.asp">Install Python3</a></li>
<li><a href="https://www.w3schools.com/python/python_pip.asp">Install PIP</a></li>
<li><a href="https://www.jetbrains.com/pycharm/">Download PyCharm</a></li>
</ul>
</section>
<section id="install-otree" class="level3" data-number="1.1.2">
<h3 data-number="1.1.2" class="anchored" data-anchor-id="install-otree"><span class="header-section-number">1.1.2</span> Install oTree</h3>
<p>Open your command line tool, that is, the terminal (Mac/Linux) or command prompt (Windows PowerShell) and type:</p>
<div class="cell" data-execution_count="1">
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a>pip3 install <span class="op">-</span>U otree</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>After the command ends, the installation is complete.</p>
</section>
<section id="download-unzip-edit-ofeeds" class="level3" data-number="1.1.3">
<h3 data-number="1.1.3" class="anchored" data-anchor-id="download-unzip-edit-ofeeds"><span class="header-section-number">1.1.3</span> Download, Unzip &amp; Edit <code>oFeeds</code></h3>
<p>Download the <code>.otreezip</code> file of the application you are interested in (that is, <a href="https://github.com/Howquez/oFeeds/blob/main/oCom/oCom.otreezip">oCom</a>, <a href="https://github.com/Howquez/oFeeds/blob/main/oNovitas/oNovitas.otreezip">oNovitas</a>, <a href="https://github.com/Howquez/oFeeds/blob/main/oTweet/oTweet.otreezip">oTweet</a>) from <a href="https://github.com/Howquez/oFeeds">GitHub</a> or <a href="https://osf.io/jcxvk/">OSF</a>. Open your command line tool and navigate (<code>cd</code>) to your desired directory. Within that directory, unpack the otreezip file you just downloaded (e.g., <em>oTweet.otreezip</em>) using the following command:</p>
<div class="cell" data-execution_count="2">
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>otree unzip oTweet.otreezip</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>This upacks the python project which contains predominantly Python code but also some JavaScript, HTML and CSS. You can edit it in your favorite IDE (such as PyCharm). I advice you to consult the <a href="https://otree.readthedocs.io/en/latest/">oTree documentation</a> if you want to edit the app’s backend as well as the <a href="https://getbootstrap.com/docs/5.2/getting-started/introduction/">Bootstrap 5.2 documentation</a> if you want to edit the frontend. In addition, the subsequent chapters describe <code>oFeeds</code>’ apps in more detail.</p>
<p>After editing your code, use your command line tool, navigate to the project directory (where also a <code>settings.py</code> file is located) and run the following command to re-pack the project into the <code>*.otreezip</code> file again:</p>
<div class="cell" data-execution_count="3">
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a>otree <span class="bu">zip</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>You will need this otreezip file to deploy the project on a server.</p>
</section>
</section>
<section id="sec-local" class="level2" data-number="1.2">
<h2 data-number="1.2" class="anchored" data-anchor-id="sec-local"><span class="header-section-number">1.2</span> Deploy <code>oFeeds</code> Locally</h2>
<p>Use your command line tool, navigate to your project folder and run:</p>
<div class="cell" data-execution_count="4">
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a>otree devserver</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</div>
<p>Open a browser to <a href="http://localhost:8000/">http://localhost:8000/</a>. This will display a <em>Demo</em> screen with a hyperlink named after the app you intend to use, e.g., <em>oTweet</em>. Click on it to create a small demo session:</p>
<p><img src="img/screenshot-demo-session.png" class="img-fluid" alt="Demo Session Screen"> The screenshot above shows such a session (with the unique id <code>1pwq8tjd</code>). You can see unique ULRs fornfour participants (P1-P4) as well as some horizontally distributed tabs. The <em>Data</em> tab is of particular interest as it shows you the data entries of each participant. It also allows you to download a corresponding <code>*.csv</code> file.</p>
<p>To quit the development setup (devserver), go to the command line tool and press <code>Control+C</code>. Note that oTree’s devserver is not designed for running actual studies.</p>
</section>
<section id="sec-server" class="level2" data-number="1.3">
<h2 data-number="1.3" class="anchored" data-anchor-id="sec-server"><span class="header-section-number">1.3</span> Deploy <code>oFeeds</code> on a Server</h2>
<p>To increase the ease of deployment, oTree’s basic server setup is tied to <a href="https://www.heroku.com/">Heroku</a>. oTree’s <a href="https://otree.readthedocs.io/en/latest/server/heroku.html">official documentation</a> explains that:</p>
<blockquote class="blockquote">
<p>Heroku is a commercial cloud hosting provider. It is the simplest way to deploy oTree. The Heroku free plan is sufficient for testing your app, but once you are ready to launch a study, you should upgrade to a paid server, which can handle more traffic. However, Heroku is quite inexpensive, because you only pay for the time you actually use it. If you run a study for only 1 day, you can turn off your dynos and addons, and then you only pay 1/30 of the monthly cost. Often this means you can run a study for just a few dollars.</p>
</blockquote>
<p>This implies that you need to set up a Heroku account. In addition, you’ll need a <a href="https://www.otreehub.com/">oTree Hub</a> account. oTree Hub automates your server setup and ensures your server is correctly configured. It also offers error/performance monitoring. Just start with the cheapest account and see how far it gets you.</p>
<p>The following steps will guide you through the process. You can and probably should also watch <a href="https://www.youtube.com/watch?v=H8Do08ub8bM">this video</a> to get you started.</p>
<ol type="1">
<li>Visit <a href="https://www.heroku.com/">Heroku</a> and create an account</li>
<li>Visit <a href="https://www.otreehub.com/">oTree Hub</a> and create an account.</li>
<li>On oTree Hub, click on <em>Heroku server deployment</em>.</li>
<li>Click on <em>Connect to Heroku</em>.</li>
<li>This will navigate you to a Heroku login interface. Log in to proceed.</li>
<li>This will redirect you to oTree Hub and ask you to verify your Heroku account by providing credit card details. Do that (on Heroku) to proceed.</li>
<li>Next, visit your Heroku <em>Dashboard</em> and create a new app. Tipp: Use a rather generic name that you can reuse for future (and potentially unrelated) studies.</li>
<li>Go back to oTree Hub, click <em>Heroku</em> in the navigation bar. You should see the Heroku app you just created beneath <em>Other Sites</em>. Click on <em>register</em> right next to it.</li>
<li>Your Heroku app should now be displayed as an <em>Active Site</em>. Click on <em>Deploy</em>.</li>
<li>This will direct you to an interface where you can upload your <code>*.otreezip</code> file. Click on <em>Browse</em> to do so. If you haven’t done so already, you can download the <code>*.otreezip</code> file of the application you are interested in (that is, <a href="https://github.com/Howquez/oFeeds/blob/main/oCom/oCom.otreezip">oCom</a>, <a href="https://github.com/Howquez/oFeeds/blob/main/oNovitas/oNovitas.otreezip">oNovitas</a>, <a href="https://github.com/Howquez/oFeeds/blob/main/oTweet/oTweet.otreezip">oTweet</a>) from <a href="https://github.com/Howquez/oFeeds">GitHub</a> or <a href="https://osf.io/jcxvk/">OSF</a>.</li>
<li>Click <em>Upload</em> and wait for up to a few minutes.</li>
<li>Click <em>Configure</em> to set up your data base.</li>
<li>For testing purposes, choose the smallest <code>Postgres plan</code> (mini) as well as the smallest <code>Dyno size</code> (Eco), open access <code>OTREE_AUTH_LEVEL</code> and <code>OTREE_PRODUCTION</code> off (to display error messages etc.). Submit changes. You can verify, change and undo these settings on Heroku: visit your app and click on resources. This will also show you the estimates monthly costs of deployment. To run a study, choose different settings, i.e., a larger <code>Postgres plan</code>, larger <code>Dyno size</code> and <code>OTREE_PRODUCTION</code> on.</li>
<li>Click <em>Reset database</em>. Be aware that this will delete all the data you may have collected in a previous study.</li>
<li>Click on the link provided in the upper third of the page, that is, <code>https://[your app name].herokuapp.com</code>. This will yield the same interface as if you tested the study locally on a devserver (described in <a href="#sec-local"><span>Section&nbsp;1.2</span></a> of this chapter).</li>
<li>Done. You can now create and configure sessions to distribute the study to participants.</li>
</ol>
<p>The following chapters will describe how to do that for each app individually. (The apps differ slightly with respect to their features, for instance, because the news feed can display two banner ads, while the other can only display one. For that reason, the apps’ configurations differ too.)</p>
<ul>
<li>See how to configure a oCom session in <a href="oCom.html">Chapter&nbsp;<span>2</span></a>.</li>
<li>See how to configure a oNovitas session in <a href="oNovitas.html">Chapter&nbsp;<span>3</span></a>.</li>
<li>See how to configure a oTweet session in <a href="oTweet.html">Chapter&nbsp;<span>4</span></a>.</li>
</ul>


</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
  function tippyHover(el, contentFn) {
    const config = {
      allowHTML: true,
      content: contentFn,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start'
    };
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      return note.innerHTML;
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
<nav class="page-navigation">
  <div class="nav-page nav-page-previous">
      <a href="./index.html" class="pagination-link">
        <i class="bi bi-arrow-left-short"></i> <span class="nav-page-text">Preface</span>
      </a>          
  </div>
  <div class="nav-page nav-page-next">
      <a href="./oCom.html" class="pagination-link">
        <span class="nav-page-text"><span class="chapter-number">2</span>&nbsp; <span class="chapter-title">oCom</span></span> <i class="bi bi-arrow-right-short"></i>
      </a>
  </div>
</nav>
</div> <!-- /content -->



</body></html>